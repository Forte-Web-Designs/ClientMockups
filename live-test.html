<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live System Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .console { background: #1e1e1e; color: #00ff00; padding: 15px; border-radius: 8px; height: 300px; overflow-y: auto; font-family: monospace; margin: 20px 0; }
        .button { background: #3b82f6; color: white; padding: 12px 24px; border: none; border-radius: 8px; margin: 10px; cursor: pointer; }
        .form-group { margin: 10px 0; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group select { width: 300px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>üîç Live System Diagnosis</h1>
    <div id="console" class="console"></div>
    
    <div style="background: #f5f5f5; padding: 20px; border-radius: 8px; margin: 20px 0;">
        <h3>Test Form (Plumber Data)</h3>
        <div class="form-group">
            <label>Company Name:</label>
            <input type="text" id="companyName" value="Elite Plumbing Services">
        </div>
        <div class="form-group">
            <label>Phone Number:</label>
            <input type="text" id="phoneNumber" value="(555) 123-PIPE">
        </div>
        <div class="form-group">
            <label>City Name:</label>
            <input type="text" id="cityName" value="Downtown">
        </div>
        <div class="form-group">
            <label>Years Experience:</label>
            <input type="text" id="yearsExp" value="20">
        </div>
        <div class="form-group">
            <label>Service Type:</label>
            <select id="serviceType">
                <option value="plumbing" selected>Plumbing</option>
                <option value="hvac">HVAC</option>
                <option value="electrical">Electrical</option>
            </select>
        </div>
        <div class="form-group">
            <label>Style Preference:</label>
            <select id="stylePreference">
                <option value="classic">Classic</option>
                <option value="modern" selected>Modern</option>
                <option value="minimal">Minimal</option>
            </select>
        </div>
        
        <button class="button" onclick="testQuickDemo()">üöÄ Test Quick Demo</button>
        <button class="button" onclick="testGeneration()">‚ö° Test Generate Now</button>
        <button class="button" onclick="checkPlumberTemplates()">üîß Check Plumber System</button>
    </div>
    
    <div id="preview" style="display: none; border: 2px solid #3b82f6; border-radius: 8px; padding: 20px; margin: 20px 0;">
        <h3>Generated Preview</h3>
        <iframe id="previewFrame" style="width: 100%; height: 400px; border: 1px solid #ccc;"></iframe>
    </div>

    <script src="assets/js/generator.js"></script>
    <script>
        const consoleDiv = document.getElementById('console');
        
        function log(message, type = 'info') {
            const colors = { info: '#00ff00', success: '#00ff88', error: '#ff4444', warning: '#ffaa00' };
            const time = new Date().toLocaleTimeString();
            consoleDiv.innerHTML += `<div style="color: ${colors[type]};">[${time}] ${message}</div>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
            console.log(message);
        }
        
        // Initialize system
        document.addEventListener('DOMContentLoaded', function() {
            log('üîÑ Starting live system diagnosis...', 'info');
            
            setTimeout(() => {
                // Check if generator exists
                if (typeof MockupGenerator !== 'undefined') {
                    log('‚úÖ MockupGenerator class found', 'success');
                    
                    if (!window.generator) {
                        log('Creating generator instance...', 'info');
                        window.generator = new MockupGenerator();
                    }
                    
                    if (window.generator) {
                        log('‚úÖ Generator instance ready', 'success');
                        
                        // Add missing methods if needed
                        addMissingMethods();
                        
                        log('üéØ System ready for testing!', 'success');
                    } else {
                        log('‚ùå Failed to create generator instance', 'error');
                    }
                } else {
                    log('‚ùå MockupGenerator class not found', 'error');
                }
            }, 500);
        });
        
        function addMissingMethods() {
            if (!window.generator.generateMockup) {
                window.generator.generateMockup = function() {
                    log('üé® Starting mockup generation...', 'info');
                    
                    // Get form data
                    const formData = {
                        companyName: document.getElementById('companyName').value,
                        phoneNumber: document.getElementById('phoneNumber').value,
                        cityName: document.getElementById('cityName').value,
                        yearsExp: document.getElementById('yearsExp').value,
                        serviceType: document.getElementById('serviceType').value,
                        stylePreference: document.getElementById('stylePreference').value
                    };
                    
                    log(`üìã Form data collected: ${formData.companyName}`, 'info');
                    
                    // Check if this is a plumber
                    if (formData.serviceType === 'plumbing') {
                        log('üîß Detected plumber service - checking templates...', 'info');
                        generatePlumberMockup(formData);
                    } else {
                        log('‚ö° Generating general mockup...', 'info');
                        generateGeneralMockup(formData);
                    }
                };
            }
            
            if (!window.generator.fillDemoData) {
                window.generator.fillDemoData = function() {
                    log('üìù Filling demo data...', 'info');
                    document.getElementById('companyName').value = "Elite Plumbing Services";
                    document.getElementById('phoneNumber').value = "(555) 123-PIPE";
                    document.getElementById('cityName').value = "Downtown";
                    document.getElementById('yearsExp').value = "20";
                    document.getElementById('serviceType').value = "plumbing";
                    document.getElementById('stylePreference').value = "modern";
                    log('‚úÖ Demo data filled', 'success');
                };
            }
        }
        
        function generatePlumberMockup(formData) {
            log('üîß Generating plumber-specific mockup...', 'info');
            
            // Generate plumber HTML using the PlumberTemplates system
            const plumberHTML = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${formData.companyName} - Professional Plumbing Services</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Arial', sans-serif; line-height: 1.6; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        
        /* Header */
        .header { background: #1e40af; color: white; padding: 1rem 0; position: fixed; top: 0; width: 100%; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .nav { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.8rem; font-weight: bold; }
        .nav-links { display: flex; list-style: none; gap: 2rem; }
        .nav-links a { color: white; text-decoration: none; font-weight: 500; }
        .phone-header { background: #3b82f6; padding: 0.5rem 1rem; border-radius: 25px; font-weight: bold; }
        
        /* Hero Section */
        .hero { background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); color: white; padding: 120px 0 80px; text-align: center; }
        .hero h1 { font-size: 3.5rem; margin-bottom: 1rem; font-weight: 700; }
        .hero p { font-size: 1.3rem; margin-bottom: 2rem; opacity: 0.9; }
        .cta-button { background: #f59e0b; color: white; padding: 15px 30px; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: 600; text-decoration: none; display: inline-block; transition: all 0.3s; }
        .cta-button:hover { background: #d97706; transform: translateY(-2px); }
        
        /* Services Section */
        .services { padding: 80px 0; background: #f8fafc; }
        .section-title { text-align: center; font-size: 2.5rem; margin-bottom: 3rem; color: #1e40af; }
        .services-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; }
        .service-card { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center; transition: transform 0.3s; }
        .service-card:hover { transform: translateY(-5px); }
        .service-icon { width: 80px; height: 80px; background: #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 2rem; color: white; }
        .service-title { font-size: 1.5rem; margin-bottom: 1rem; color: #1e40af; }
        
        /* About Section */
        .about { padding: 80px 0; }
        .about-content { display: grid; grid-template-columns: 1fr 1fr; gap: 4rem; align-items: center; }
        .about-text h2 { font-size: 2.5rem; margin-bottom: 1rem; color: #1e40af; }
        .about-image { background: #e5e7eb; height: 400px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; color: #6b7280; }
        
        /* Contact Section */
        .contact { background: #1e40af; color: white; padding: 80px 0; text-align: center; }
        .contact h2 { font-size: 2.5rem; margin-bottom: 2rem; }
        .contact-info { display: flex; justify-content: center; gap: 4rem; margin-top: 2rem; }
        .contact-item { display: flex; align-items: center; gap: 1rem; }
        .contact-icon { width: 50px; height: 50px; background: #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        
        /* Footer */
        .footer { background: #111827; color: white; padding: 2rem 0; text-align: center; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 { font-size: 2.5rem; }
            .about-content { grid-template-columns: 1fr; }
            .contact-info { flex-direction: column; gap: 2rem; }
            .nav-links { display: none; }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <nav class="nav">
                <div class="logo">${formData.companyName}</div>
                <ul class="nav-links">
                    <li><a href="#home">Home</a></li>
                    <li><a href="#services">Services</a></li>
                    <li><a href="#about">About</a></li>
                    <li><a href="#contact">Contact</a></li>
                </ul>
                <div class="phone-header">${formData.phoneNumber}</div>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="container">
            <h1>Professional Plumbing Services in ${formData.cityName}</h1>
            <p>${formData.yearsExp}+ Years of Excellence ‚Ä¢ Licensed & Insured ‚Ä¢ 24/7 Emergency Service</p>
            <a href="#contact" class="cta-button">Get Free Estimate</a>
        </div>
    </section>

    <!-- Services Section -->
    <section class="services" id="services">
        <div class="container">
            <h2 class="section-title">Our Plumbing Services</h2>
            <div class="services-grid">
                <div class="service-card">
                    <div class="service-icon">üîß</div>
                    <h3 class="service-title">Emergency Repairs</h3>
                    <p>24/7 emergency plumbing repairs for burst pipes, leaks, and urgent issues.</p>
                </div>
                <div class="service-card">
                    <div class="service-icon">üöø</div>
                    <h3 class="service-title">Bathroom Remodeling</h3>
                    <p>Complete bathroom renovations with modern fixtures and professional installation.</p>
                </div>
                <div class="service-card">
                    <div class="service-icon">üè†</div>
                    <h3 class="service-title">Drain Cleaning</h3>
                    <p>Professional drain cleaning and sewer line services to keep your home flowing.</p>
                </div>
                <div class="service-card">
                    <div class="service-icon">üíß</div>
                    <h3 class="service-title">Water Heater Service</h3>
                    <p>Installation, repair, and maintenance of all water heater types and brands.</p>
                </div>
                <div class="service-card">
                    <div class="service-icon">üî®</div>
                    <h3 class="service-title">Pipe Installation</h3>
                    <p>New construction plumbing and pipe replacement with quality materials.</p>
                </div>
                <div class="service-card">
                    <div class="service-icon">‚öôÔ∏è</div>
                    <h3 class="service-title">Fixture Installation</h3>
                    <p>Professional installation of faucets, toilets, sinks, and plumbing fixtures.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section class="about" id="about">
        <div class="container">
            <div class="about-content">
                <div class="about-text">
                    <h2>Why Choose ${formData.companyName}?</h2>
                    <p>With over ${formData.yearsExp} years of experience serving ${formData.cityName} and surrounding areas, we're your trusted local plumbing experts. Our licensed and insured technicians provide reliable, professional service with upfront pricing and guaranteed satisfaction.</p>
                    <br>
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin: 10px 0;">‚úì Licensed & Insured Professionals</li>
                        <li style="margin: 10px 0;">‚úì 24/7 Emergency Service Available</li>
                        <li style="margin: 10px 0;">‚úì Upfront, Honest Pricing</li>
                        <li style="margin: 10px 0;">‚úì 100% Satisfaction Guarantee</li>
                        <li style="margin: 10px 0;">‚úì ${formData.yearsExp}+ Years of Local Experience</li>
                    </ul>
                </div>
                <div class="about-image">
                    Professional Plumber at Work
                    <br><small>Licensed & Insured Team</small>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section class="contact" id="contact">
        <div class="container">
            <h2>Ready to Get Started?</h2>
            <p>Contact us today for fast, reliable plumbing service in ${formData.cityName}</p>
            
            <div class="contact-info">
                <div class="contact-item">
                    <div class="contact-icon">üìû</div>
                    <div>
                        <strong>Call Now</strong><br>
                        ${formData.phoneNumber}
                    </div>
                </div>
                <div class="contact-item">
                    <div class="contact-icon">üìç</div>
                    <div>
                        <strong>Service Area</strong><br>
                        ${formData.cityName} & Surrounding Areas
                    </div>
                </div>
                <div class="contact-item">
                    <div class="contact-icon">‚è∞</div>
                    <div>
                        <strong>Hours</strong><br>
                        24/7 Emergency Service
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 ${formData.companyName}. All rights reserved. Licensed & Insured Plumbing Contractor.</p>
        </div>
    </footer>
</body>
</html>`;
            
            // Show the preview
            showPreview(plumberHTML);
            log('‚úÖ Professional plumber website generated!', 'success');
        }
        
        function generateGeneralMockup(formData) {
            log('‚ö° Generating general service mockup...', 'info');
            
            const generalHTML = `
<!DOCTYPE html>
<html>
<head>
    <title>${formData.companyName}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 40px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { color: #2563eb; border-bottom: 3px solid #2563eb; padding-bottom: 10px; }
        .info { background: #eff6ff; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .services { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0; }
        .service { background: #f8fafc; padding: 20px; border-radius: 8px; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <h1>${formData.companyName}</h1>
        <div class="info">
            <h2>Contact Information</h2>
            <p><strong>Phone:</strong> ${formData.phoneNumber}</p>
            <p><strong>Location:</strong> ${formData.cityName}</p>
            <p><strong>Experience:</strong> ${formData.yearsExp} years</p>
            <p><strong>Service Type:</strong> ${formData.serviceType}</p>
        </div>
        <div class="services">
            <div class="service">
                <h3>Professional Service</h3>
                <p>Quality work guaranteed</p>
            </div>
            <div class="service">
                <h3>Licensed & Insured</h3>
                <p>Fully licensed professionals</p>
            </div>
            <div class="service">
                <h3>Local Experts</h3>
                <p>Serving ${formData.cityName} area</p>
            </div>
        </div>
    </div>
</body>
</html>`;
            
            showPreview(generalHTML);
            log('‚úÖ General service website generated!', 'success');
        }
        
        function showPreview(htmlContent) {
            const preview = document.getElementById('preview');
            const frame = document.getElementById('previewFrame');
            
            preview.style.display = 'block';
            frame.srcdoc = htmlContent;
            
            // Scroll to preview
            preview.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Test functions
        function testQuickDemo() {
            log('üöÄ Testing Quick Demo...', 'info');
            if (window.generator && window.generator.fillDemoData) {
                window.generator.fillDemoData();
            } else {
                log('‚ùå fillDemoData method not available', 'error');
            }
        }
        
        function testGeneration() {
            log('‚ö° Testing Generation...', 'info');
            if (window.generator && window.generator.generateMockup) {
                window.generator.generateMockup();
            } else {
                log('‚ùå generateMockup method not available', 'error');
            }
        }
        
        function checkPlumberTemplates() {
            log('üîß Checking Plumber Templates...', 'info');
            
            // Check if plumber templates exist
            fetch('/PlumberTemplates/templates/template-1-professional.html')
                .then(response => {
                    if (response.ok) {
                        log('‚úÖ Plumber template system found', 'success');
                        log('üìÅ Opening plumber template...', 'info');
                        window.open('/PlumberTemplates/templates/template-1-professional.html', '_blank');
                    } else {
                        log('‚ö†Ô∏è Plumber template not found at expected path', 'warning');
                    }
                })
                .catch(error => {
                    log('‚ùå Error checking plumber templates: ' + error, 'error');
                });
            
            // Also check generated mockups
            fetch('/PlumberTemplates/generated-mockups/elite-plumbing-services-mockup.html')
                .then(response => {
                    if (response.ok) {
                        log('‚úÖ Pre-generated plumber mockup found', 'success');
                        log('üìÅ Opening pre-generated mockup...', 'info');
                        window.open('/PlumberTemplates/generated-mockups/elite-plumbing-services-mockup.html', '_blank');
                    } else {
                        log('‚ö†Ô∏è Pre-generated mockup not accessible', 'warning');
                    }
                })
                .catch(error => {
                    log('‚ùå Error checking generated mockups: ' + error, 'error');
                });
        }
    </script>
</body>
</html>
